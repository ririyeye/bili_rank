# Bç«™è§†é¢‘å®æ—¶åœ¨çº¿äººæ•°æ’è¡Œæ¦œ - Rust ç‰ˆæœ¬

è¿™æ˜¯ä¸€ä¸ª Rust å®ç°çš„ B ç«™æ’è¡Œæ¦œçˆ¬è™«ï¼Œå¯ä»¥è·å– B ç«™çƒ­é—¨è§†é¢‘çš„å®æ—¶åœ¨çº¿è§‚çœ‹äººæ•°ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸš€ **å¿«é€Ÿé¦–è½®æŸ¥è¯¢**: å¯åŠ¨æ—¶ä½¿ç”¨é«˜å¹¶å‘ï¼ˆé»˜è®¤ 20 å¹¶å‘ï¼‰å¿«é€Ÿè·å–æ•°æ®
- â±ï¸ **å®šæ—¶è½®è¯¢**: åç»­æŒ‰æŒ‡å®šé—´éš”ï¼ˆé»˜è®¤ 300 ç§’ï¼‰å®šæ—¶æ›´æ–°æ•°æ®
- ğŸŒ **å†…ç½® HTTP æœåŠ¡å™¨**: æä¾› Web ç•Œé¢å’Œ JSON API
- ğŸ“Š **è¿›åº¦è·Ÿè¸ª**: å®æ—¶æ˜¾ç¤ºæŠ“å–è¿›åº¦
- ğŸ”§ **çµæ´»é…ç½®**: æ”¯æŒå¤šç§å‘½ä»¤è¡Œå‚æ•°

## ç¼–è¯‘

```bash
cd bili_rank_rust
cargo build --release
```

ç¼–è¯‘åçš„å¯æ‰§è¡Œæ–‡ä»¶ä½äº `target/release/bili_rank.exe`ï¼ˆWindowsï¼‰æˆ– `target/release/bili_rank`ï¼ˆLinux/macOSï¼‰ã€‚

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

```bash
# ä½¿ç”¨é»˜è®¤é…ç½®å¯åŠ¨ï¼ˆç«¯å£ 8000ï¼Œé—´éš” 300 ç§’ï¼‰
./bili_rank

# æŒ‡å®šç«¯å£
./bili_rank --port 8080

# æŒ‡å®šæŸ¥è¯¢é—´éš”ï¼ˆç§’ï¼‰
./bili_rank --interval 600
```

### å‘½ä»¤è¡Œå‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `--host` | `0.0.0.0` | ç›‘å¬åœ°å€ |
| `--port` | `8000` | ç›‘å¬ç«¯å£ |
| `--interval` | `300` | æŸ¥è¯¢é—´éš”ï¼ˆç§’ï¼‰ |
| `--output-file` | `false` | æ˜¯å¦è¾“å‡º data.json æ–‡ä»¶ |
| `--output-path` | `data.json` | è¾“å‡ºæ–‡ä»¶è·¯å¾„ |
| `--rapid-concurrency` | `20` | ç¬¬ä¸€è½®å¹¶å‘æ•° |
| `--normal-concurrency` | `5` | åç»­è½®æ¬¡å¹¶å‘æ•° |
| `--log-error-json` | `false` | æ˜¯å¦è®°å½•é”™è¯¯å“åº”çš„ JSON |

### ç¤ºä¾‹

```bash
# å®Œæ•´é…ç½®ç¤ºä¾‹
./bili_rank \
    --host 0.0.0.0 \
    --port 8000 \
    --interval 300 \
    --rapid-concurrency 30 \
    --normal-concurrency 10

# è¾“å‡º JSON æ–‡ä»¶
./bili_rank --output-file --output-path ./data.json
```

## API æ¥å£

å¯åŠ¨åå¯è®¿é—®ä»¥ä¸‹æ¥å£ï¼š

| æ¥å£ | è¯´æ˜ |
|------|------|
| `GET /` | Web ç•Œé¢ |
| `GET /index.html` | Web ç•Œé¢ |
| `GET /data.json` | æ’è¡Œæ¦œ JSON æ•°æ® |
| `GET /progress` | æŠ“å–è¿›åº¦ |
| `GET /progress.json` | æŠ“å–è¿›åº¦ï¼ˆåŒä¸Šï¼‰ |
| `GET /status` | æŠ“å–çŠ¶æ€ï¼ˆåŒä¸Šï¼‰ |

### æ•°æ®æ ¼å¼

`/data.json` è¿”å›æ ¼å¼ï¼š

```json
{
  "BV1xxxxxxxxxx": {
    "title": "è§†é¢‘æ ‡é¢˜",
    "owner": "UPä¸»åç§°",
    "mid": "UPä¸»ID",
    "pic": "å°é¢å›¾ç‰‡URL",
    "online_count": "1.5ä¸‡+",
    "count_num": 15000
  }
}
```

`/progress` è¿”å›æ ¼å¼ï¼š

```json
{
  "fetching": true,
  "completed": 50,
  "total": 100,
  "percent": 50.0,
  "last_data_time": "Thu, 27 Nov 2025 14:30:00 GMT",
  "progress_time": "Thu, 27 Nov 2025 14:30:05 GMT"
}
```

## ä¸ C++ ç‰ˆæœ¬çš„å¯¹æ¯”

| ç‰¹æ€§ | C++ ç‰ˆæœ¬ | Rust ç‰ˆæœ¬ |
|------|----------|-----------|
| é»˜è®¤ç«¯å£ | 8000 | 8000 |
| é»˜è®¤é—´éš” | 300s | 300s |
| é¦–è½®å¹¶å‘ | 20 | 20 |
| è¾“å‡ºæ–‡ä»¶ | é»˜è®¤è¾“å‡º | é»˜è®¤ä¸è¾“å‡º |
| TLS æ”¯æŒ | OpenSSL | rustls |

## ä¾èµ–

- `tokio` - å¼‚æ­¥è¿è¡Œæ—¶
- `reqwest` - HTTP å®¢æˆ·ç«¯
- `axum` - Web æ¡†æ¶
- `serde` / `serde_json` - JSON åºåˆ—åŒ–
- `clap` - å‘½ä»¤è¡Œè§£æ
- `tracing` - æ—¥å¿—

## è®¸å¯è¯

MIT License
